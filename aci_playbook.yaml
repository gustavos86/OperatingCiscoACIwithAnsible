################################################################################
# v0.18 2021-June-5                                                            #
# This Ansible playbook comes with no guarantees                               #
# The use of this Ansible playbook is responsibility solely of who executes it #
# No liabilities shall be deemed to the creator of this Ansible playbook       #
#                                                                              #
################################################################################

- name: ACI playbook
  hosts: apicsim_sandbox_example
  connection: local
  gather_facts: no

  vars:
    loop_control_pause: 0           # Adds a delay between loop iterations. Required when the APIC cannot handle the rate of all the connections

  roles:
  ###############################
  #                             #
  #       Access Policies       #
  #                             #
  ###############################

  - { role: Interface_Policies,              tags: intpolicies     }    # CDP, LLDP, Fibre Channel, MCP, Link Level, Port Channel, Spanning Tree Interface policies
  - { role: Switch_and_Interface_Profiles,   tags: switchprofiles  }    # Add Switches Profiles and Interface Profiles (needed when adding new switches to ACI)

  - { role: Interface_Selectors,             tags: intselectors    }    # Assigns the previous items to specific ports on the Switches
  - { role: Interface_Policy_Groups,         tags: intpolicygroups }    # Creates Interface Access Port, Port-Channels and vPCs
  - { role: enable_or_disable_ports,         tags: shutdownports   }    # Interfaces (regular operation)

  - { role: AAEPs,                           tags: aaeps           }    # AAEPs, Domains and VLAN Pools
  - { role: Domains,                         tags: domains         } 
  - { role: VLAN_Pools,                      tags: vlanpools       } 

  ###############################
  #                             #
  #           Tenants           #
  #                             #
  ###############################

  - { role: Tenants_and_VRFs,                tags: tenants        }
  - { role: BridgeDomains_and_Subnets,       tags: bds            }
  - { role: AppProfiles_and_EPGs,            tags: epgs           }
  - { role: Domains_and_EPG_Static_Bindings, tags: staticbindings }
  - { role: Associate_L3Out_in_BridgeDomain, tags: bdtol3out      }

  ############ L3Outs ############

  - { role: L3Outs,                          tags: l3outs         }

  ########### Contracts ###########

  - { role: vzAny,                           tags: vzany          }   # 'permit any' for all the EPGs in the VRF
  - { role: EPG_to_EPG_Contracts,            tags: contracts      }